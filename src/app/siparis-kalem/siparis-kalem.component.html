<p-toolbar class="mt-0">
  <div class="border-round font-bold flex align-items-center justify-content-center" style="margin-right: 5px;">
    @if (!selectedSiparisKalemiObject()) {
      <p-button
        class="buttonRefresh"
        icon="pi pi-refresh"
        (click)="refresh()"
        [style]="{'background-color': '#4087be'}">
      </p-button>
      <p-button
        class="buttonAdd"
        icon="pi pi-plus"
        (click)="showSaveForm()"
        [style]="{'background-color': '#28a745', 'margin': '2px'}">
      </p-button>
    }
    @if (selectedSiparisKalemiObject()) {
      <p-button
        class="buttonEdit"
        icon="pi pi-pen-to-square"
        (click)="showUpdateForm()"
        [style]="{'background-color': '#ff9800'}">
      </p-button>
      <p-button
        class="buttonDelete"
        icon="pi pi-trash"
        (click)="deleteSiparisKalemiConfirm($event)"
        [style]="{'background-color': '#dc3545', 'margin': '2px'}">
      </p-button>
    }
  </div>
</p-toolbar>

<p-toolbar class="mt-0">
  <div class="border-round font-bold flex align-items-center justify-content-center" style="margin-right: 5px;">

    <p-button
      (click)="refresh()"
      [style]="{
        'background-color': '#4087be',
        'border': 'none',
        'box-shadow': 'none',
        'outline': 'none'
      }"
      class="buttonRefresh"
      icon="pi pi-refresh"
      label="Yenile">
    </p-button>

    <p-button
      (click)="showSaveForm()"
      [style]="{
        'background-color': '#28a745',
        'margin': '2px',
        'border': 'none',
        'box-shadow': 'none',
        'outline': 'none'
      }"
      class="buttonAdd"
      icon="pi pi-plus"
      label="Ekle">
    </p-button>

    @if (selectedSiparisKalemiObject()) {
      <p-button
        label="Güncele"
        class="buttonEdit"
        icon="pi pi-pen-to-square"
        (click)="showUpdateForm()"
        [style]="{
          'background-color': '#ff9800',
          'border': 'none',
          'box-shadow': 'none',
          'outline': 'none'
        }">
      </p-button>

      <p-button
        label="Sil"
        class="buttonDelete"
        icon="pi pi-trash"
        (click)="deleteSiparisKalemiConfirm($event)"
        [style]="{
          'background-color': '#dc3545',
          'margin': '2px',
          'border': 'none',
          'box-shadow': 'none',
          'outline': 'none'
        }">
      </p-button>
    }
  </div>
</p-toolbar>

<p-table
  [(selection)]="selectedSiparisKalemiObject"
  [metaKeySelection]="metaKey"
  [tableStyle]="{'min-width': '50rem'}"
  [value]="siparisKalemiDatas()"
  dataKey="id"
  selectionMode="single"
  stripedRows>
  <ng-template #header>
    <tr>
      <th>#</th>
      <th>Sipariş</th>
      <th>Menü Ürünü</th>
      <th>Adet</th>
      <th>Birim Fiyat</th>
      <th>Not</th>
    </tr>
  </ng-template>
  <ng-template #body let-kalem let-i="rowIndex">
    <tr [pSelectableRow]="kalem">
      <td>{{ i + 1 }}</td>
      <
      <td>{{ kalem.siparis.id === kalem.siparisId.musteriAd || 'Bilinmeyen Sipariş' }}</td>
      <td>{{ kalem.menuItemId?.ad || 'Bilinmeyen Ürün' }}</td>
      <td>{{ kalem.adet }}</td>
      <td>{{ kalem.birimFiyat }}</td>
      <td>{{ kalem.not || '-' }}</td>
    </tr>
  </ng-template>
</p-table>

<form [formGroup]="siparisKalemiSaveForm">
  <p-dialog header="Sipariş Kalemi Ekle" [(visible)]="displaySaveForm" [style]="{width: '400px'}" [modal]="true">
    <div class="formgrid grid">
      <div class="field col-12">
        <label for="siparis" style="font-weight: bold">Sipariş</label>
        <p-select
          id="siparis"
          [options]="siparisOptions()"
          optionLabel="musteriAd"
          optionValue="id"
          formControlName="siparis"
          class="w-full"
          placeholder="Sipariş seçiniz">
        </p-select>
      </div>
      <div class="field col-12">
        <label for="menuItem" style="font-weight: bold">Menü Ürünü</label>
        <p-select
          id="menuItem"
          [options]="menuItemOptions()"
          optionLabel="ad"
          optionValue="id"
          formControlName="menuItem"
          class="w-full"
          placeholder="Ürün seçiniz">
        </p-select>
      </div>
      <div class="field col-12">
        <label for="adet" style="font-weight: bold">Adet</label>
        <input id="adet" type="number" placeholder="Adet giriniz" pInputText class="w-full" formControlName="adet"
               min="1">
      </div>
      <div class="field col-12">
        <label for="birimFiyat" style="font-weight: bold">Birim Fiyat</label>
        <input id="birimFiyat" type="number" placeholder="Birim fiyat giriniz" pInputText class="w-full"
               formControlName="birimFiyat">
      </div>
      <div class="field col-12">
        <label for="not" style="font-weight: bold">Not</label>
        <input id="not" placeholder="Not giriniz" pInputText class="w-full" formControlName="not">
      </div>
    </div>

    <ng-template #footer>
      <p-button (click)="closeSaveForm()" icon="pi pi-times" label="İptal" severity="secondary"></p-button>
      <p-button (click)="saveSiparisKalemi()" [disabled]="!siparisKalemiSaveForm.valid" icon="pi pi-save"
                label="Kaydet"></p-button>
    </ng-template>
  </p-dialog>
</form>

<form [formGroup]="siparisKalemiUpdateForm">
  <p-dialog header="Sipariş Kalemi Düzenle" [(visible)]="displayUpdateForm" [style]="{width: '400px'}" [modal]="true">
    <div class="formgrid grid">
      <div class="field col-12">
        <label for="idUp">Kalem ID</label>
        <input id="idUp" pInputText class="w-full" formControlName="id" readonly pTooltip="Bu alan düzenlenemez!"
               tooltipPosition="top">
      </div>
      <div class="field col-12">
        <label for="menuItemIdUp">Menü Ürünü</label>
        <p-select
          id="menuItemIdUp"
          [options]="menuItemOptions()"
          optionLabel="ad"
          optionValue="id"
          formControlName="menuItem"
          class="w-full"
          placeholder="Ürün seçiniz">
        </p-select>
      </div>
      <div class="field col-12">
        <label for="adetUp">Adet</label>
        <input id="adetUp" type="number" pInputText class="w-full" formControlName="adet" min="1">
      </div>
      <div class="field col-12">
        <label for="birimFiyatUp">Birim Fiyat</label>
        <input id="birimFiyatUp" type="number" pInputText class="w-full" formControlName="birimFiyat">
      </div>
      <div class="field col-12">
        <label for="notUp">Not</label>
        <input id="notUp" pInputText class="w-full" formControlName="not">
      </div>
    </div>

    <ng-template #footer>
      <p-button (click)="closeSaveForm()" icon="pi pi-times" label="İptal" severity="secondary"></p-button>
      <p-button (click)="updateSiparisKalemi()" [disabled]="!siparisKalemiUpdateForm.valid" icon="pi pi-save"
                label="Kaydet"></p-button>
    </ng-template>
  </p-dialog>
</form>

<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>
