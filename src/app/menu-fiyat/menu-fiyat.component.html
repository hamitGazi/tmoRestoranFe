<p-toolbar class="mt-0">
  <div class="border-round font-bold flex align-items-center justify-content-center" style="margin-right: 5px;">

    <p-button
      (click)="refresh()"
      [style]="{
        'background-color': '#4087be',
        'border': 'none',
        'box-shadow': 'none',
        'outline': 'none'
      }"
      class="buttonRefresh"
      icon="pi pi-refresh"
      label="Yenile">
    </p-button>

    <p-button
      (click)="showSaveForm()"
      [style]="{
        'background-color': '#28a745',
        'margin': '2px',
        'border': 'none',
        'box-shadow': 'none',
        'outline': 'none'
      }"
      class="buttonAdd"
      icon="pi pi-plus"
      label="Ekle">
    </p-button>

    @if (selectedMenuFiyatObject()) {
      <p-button
        label="Güncele"
        class="buttonEdit"
        icon="pi pi-pen-to-square"
        (click)="showUpdateForm()"
        [style]="{
          'background-color': '#ff9800',
          'border': 'none',
          'box-shadow': 'none',
          'outline': 'none'
        }">
      </p-button>

      <p-button
        label="Sil"
        class="buttonDelete"
        icon="pi pi-trash"
        (click)="deleteMenuFiyatConfirm($event)"
        [style]="{
          'background-color': '#dc3545',
          'margin': '2px',
          'border': 'none',
          'box-shadow': 'none',
          'outline': 'none'
        }">
      </p-button>
    }
  </div>
</p-toolbar>

<p-table
  [(selection)]="selectedMenuFiyatObject"
  [metaKeySelection]="metaKey"
  [tableStyle]="{'min-width': '50rem'}"
  [value]="menuFiyatDatas()"
  dataKey="id"
  selectionMode="single"
  stripedRows>
  <ng-template #header>
    <tr>
      <th>#</th>
      <th>Menü Ürünü</th>
      <th>Fiyat</th>
      <th>İndirimli Fiyat</th>
      <th>Geçerlilik Başlangıç</th>
      <th>Geçerlilik Bitiş</th>
      <th>Aktif</th>
    </tr>
  </ng-template>
  <ng-template #body let-fiyat let-i="rowIndex">
    <tr [pSelectableRow]="fiyat">
      <td>{{ i + 1 }}</td>
      <td>{{ fiyat.menuItem?.ad }}</td>
      <td>{{ fiyat.fiyat }}</td>
      <td>{{ fiyat.indirimFiyati || '-' }}</td>
      <td>{{ fiyat.gecerlilikBaslangic }}</td>
      <td>{{ fiyat.gecerlilikBitis }}</td>
      <td>{{ fiyat.aktif ? 'Evet' : 'Hayır' }}</td>
    </tr>
  </ng-template>
</p-table>


<form [formGroup]="menuFiyatSaveForm">
  <p-dialog [(visible)]="displaySaveForm" [modal]="true" [style]="{width: '400px'}" header="Fiyat Ekle">
    <div class="formgrid grid">
      <div class="field col-12">
        <label for="menuItem" style="font-weight: bold">Menü Ürünü</label>
        <p-select
          [options]="menuItemOptions()"
          class="w-full"
          formControlName="menuItem"
          id="menuItem"
          optionLabel="ad"
          optionValue="id"
          placeholder="Ürün seçiniz">
        </p-select>

      </div>
      <div class="field col-6">
        <label for="fiyat" style="font-weight: bold">Fiyat</label>
        <input class="w-full"
               formControlName="fiyat"
               id="fiyat"
               min="o" pInputText
               placeholder="Fiyat giriniz" type="number">
      </div>
      <div class="field col-6">
        <label for="indirimFiyati" style="font-weight: bold">İndirimli Fiyat</label>
        <input class="w-full"
               formControlName="indirimFiyati"
               id="indirimFiyati"
               min="0" pInputText
               placeholder="İndirimli fiyat giriniz" type="number">
      </div>
      <div class="field col-12">
        <label style="font-weight: bold">Geçerlilik Başlangıç</label>
        <p-date-picker
          [showButtonBar]="true"
          [style]="{width:'100%'}"
          appendTo="body"
          dateFormat="dd.mm.yy"
          formControlName="gecerlilikBaslangic"
        ></p-date-picker>
      </div>
      <div class="field col-12">
        <label style="font-weight: bold">Geçerlilik Bitiş</label>
        <p-date-picker
          [showButtonBar]="true"
          [style]="{width:'100%'}"
          appendTo="body"
          dateFormat="dd.mm.yy"
          formControlName="gecerlilikBitis"
        ></p-date-picker>
      </div>
      <div class="field col-12">
        <label for="aktif" style="font-weight: bold">Aktif</label>
        <p-checkbox [binary]="true" formControlName="aktif" id="aktif"></p-checkbox>
      </div>
    </div>
    <ng-template #footer>
      <p-button (click)="closeSaveForm()" icon="pi pi-times" label="İptal" severity="secondary"></p-button>
      <p-button (click)="saveMenuFiyat()" [disabled]="!menuFiyatSaveForm.valid" icon="pi pi-save" label="Kaydet"></p-button>
    </ng-template>
  </p-dialog>
</form>

<form [formGroup]="menuFiyatUpdateForm">
  <p-dialog [(visible)]="displayUpdateForm" [modal]="true" [style]="{width: '400px'}" header="Fiyat Düzenle">
    <div class="formgrid grid">

        <div class="field col-12">
          <label for="menuItemd" style="font-weight: bold">Menü Ürünü</label>
          <p-select
            [options]="menuItemOptions()"
            class="w-full"
            formControlName="menuItem"
            id="menuItemd"
            optionLabel="ad"
            optionValue="id"
            placeholder="Ürün seçiniz">
          </p-select>
        </div>
      <div class="field col-6">
        <label for="fiyatUp">Fiyat</label>
        <input class="w-full" formControlName="fiyat" id="fiyatUp" pInputText type="number">
      </div>
      <div class="field col-6">
        <label for="indirimFiyatiUp">İndirimli Fiyat</label>
        <input class="w-full" formControlName="indirimFiyati" id="indirimFiyatiUp" pInputText type="number">
      </div>
      <div class="field col-12">
        <label style="font-weight: bold">Geçerlilik Başlangıç</label>
        <p-date-picker
          [showButtonBar]="true"
          [style]="{width:'100%'}"
          appendTo="body"
          dateFormat="dd.mm.yy"
          formControlName="gecerlilikBaslangic"
        ></p-date-picker>
      </div>
      <div class="field col-12">
        <label style="font-weight: bold">Geçerlilik Bitiş</label>
        <p-date-picker
          [showButtonBar]="true"
          [style]="{width:'100%'}"
          appendTo="body"
          dateFormat="dd.mm.yy" formControlName="gecerlilikBitis"
        ></p-date-picker>
      </div>
      <div class="field col-12">
        <label for="aktifUp">Aktif</label>
        <p-checkbox [binary]="true" formControlName="aktif" id="aktifUp"></p-checkbox>
      </div>
    </div>
    <ng-template #footer>
      <p-button (click)="closeUpdateForm()" icon="pi pi-times" label="İptal" severity="secondary"></p-button>
      <p-button (click)="updateMenuFiyat()" [disabled]="!menuFiyatUpdateForm.valid" icon="pi pi-save"
                label="Düzenle"></p-button>
    </ng-template>
  </p-dialog>
</form>


<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>
