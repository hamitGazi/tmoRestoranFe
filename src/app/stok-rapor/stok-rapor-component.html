<p-toolbar class="mt-0">
  <div class="border-round font-bold flex align-items-center justify-content-center">
    <p-button
      (click)="refresh()"
      [style]="{
        'background-color': '#4087be',
        'border': 'none',
        'box-shadow': 'none',
        'outline': 'none'
      }"
      class="buttonRefresh"
      icon="pi pi-refresh"
      label="Yenile">
    </p-button>
  </div>
</p-toolbar>

<form [formGroup]="raporFilterForm">
  <div class="formgrid grid mb-3">
    <div class="field col-12 md:col-4">
      <label for="gecerlilikBaslangic">Başlangıç Tarihi</label>
      <p-calendar
        formControlName="gecerlilikBaslangic"
        [showButtonBar]="true"
        dateFormat="dd.mm.yy"
        styleClass="w-full"
        id="gecerlilikBaslangic"
        placeholder="Başlangıç tarihi seçiniz">
      </p-calendar>
    </div>
    <div class="field col-12 md:col-4">
      <label for="gecerlilikBitis">Bitiş Tarihi</label>
      <p-calendar
        formControlName="gecerlilikBitis"
        [showButtonBar]="true"
        dateFormat="dd.mm.yy"
        styleClass="w-full"
        id="gecerlilikBitis"
        placeholder="Bitiş tarihi seçiniz">
      </p-calendar>
    </div>
    <div class="field col-12 md:col-4">
      <label for="islemTipi">İşlem Tipi</label>
      <p-select
        formControlName="islemTipi"
        [options]="islemTipEnumList()"
        optionLabel="label"
        optionValue="name"
        placeholder="İşlem tipi seçiniz"
        styleClass="w-full"
        appendTo="body"
        id="islemTipi">
      </p-select>
    </div>
    <div class="field col-12">
      <p-button
        (click)="filterRapor()"
        [style]="{
          'background-color': '#28a745',
          'border': 'none',
          'box-shadow': 'none',
          'outline': 'none'
        }"
        icon="pi pi-filter"
        label="Filtrele">
      </p-button>
    </div>
  </div>
</form>

<p-table
  [value]="raporDatas()"
  [tableStyle]="{'min-width': '50rem'}"
  dataKey="id"
  styleClass="p-datatable-striped"
  [exportFilename]="'stok-raporu'">
  <ng-template pTemplate="header">
    <tr>
      <th>#</th>
      <th>Malzeme Adı</th>
      <th>Miktar</th>
      <th>Birim</th>
      <th>Kritik Miktar</th>
      <th>İşlem Tipi</th>
      <th>İşlem Tarihi</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-rapor let-i="rowIndex">
    <tr>
      <td>{{ i + 1 }}</td>
      <td>{{ rapor.malzemeAdi }}</td>
      <td>{{ rapor.miktar }}</td>
      <td>{{ rapor.birim }}</td>
      <td>{{ rapor.kritikMiktar }}</td>
      <td>{{ rapor.islemTipi.label }}</td>
      <td>{{ rapor.islemTarihi | date:'dd.MM.yyyy' }}</td>
    </tr>
  </ng-template>
  <ng-template pTemplate="summary">
    <div class="flex justify-content-end">
      <p-button
        (click)="exportCSV()"
        [style]="{
          'background-color': '#ff9800',
          'border': 'none',
          'box-shadow': 'none',
          'outline': 'none'
        }"
        icon="pi pi-download"
        label="CSV Dışa Aktar">
      </p-button>
    </div>
  </ng-template>
</p-table>

<div class="card mt-3">
  <h3>Stok Hareket Grafiği</h3>
  <p-chart type="line" [data]="chartData()" [options]="chartOptions()"></p-chart>
</div>

<p-toast></p-toast>
